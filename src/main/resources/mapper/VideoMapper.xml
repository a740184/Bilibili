<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.gph.dao.VideoMapper" >
  <resultMap id="BaseResultMap" type="com.gph.model.Video" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="vid" property="vid" jdbcType="INTEGER" />
    <result column="vname" property="vname" jdbcType="VARCHAR" />
    <result column="vsrc" property="vsrc" jdbcType="VARCHAR" />
    <result column="userid" property="userid" jdbcType="INTEGER" />
    <result column="praise" property="praise" jdbcType="INTEGER" />
    <result column="get_icon" property="getIcon" jdbcType="INTEGER" />
    <result column="type_id" property="typeId" jdbcType="INTEGER" />
    <result column="v_image" property="vImage" jdbcType="VARCHAR" />
    <result column="vtime" property="vtime" jdbcType="TIMESTAMP"/>
    <association property="vtype" column="type_id" select="com.gph.dao.VideoTypeMapper.selectByPrimaryKey" />
    <association property="user" column="userid" select="com.gph.dao.UserMapper.selectByPrimaryKey"/>



  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    vid, vname, vsrc, userid, praise, get_icon, type_id, v_image,vtime
  </sql>

  <select id="list" resultMap="BaseResultMap">
      select vid,vname,vsrc,v_image from video
  </select>

  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from video
    where vid = #{vid,jdbcType=INTEGER}
  </select>
<!--查全部投稿-->
  <select id="selectVideoList" resultMap="BaseResultMap">
    select * from video
  </select>
  <!-- /*前5排行榜，按点赞或硬币排行*/ Set @i:=0; select  (@i:=@i+1) as '序号',vid,vname,praise from video order by praise DESC LIMIT 7-->
  <select id="rank_list" resultMap="BaseResultMap">
    select vid,vname,praise from video order by praise desc limit 5
  </select>

  <!--用户触发点赞时，点赞数加一 -->
  <update id="praise" parameterType="java.lang.Integer">
    UPDATE video SET video.praise=video.praise+1 where vid= #{vids,jdbcType=INTEGER}
  </update>

  <!--取消点赞时，点赞数减一 -->
  <update id="Subtract_praise" parameterType="java.lang.Integer">
    UPDATE video SET video.praise=video.praise-1 where vid= #{vids,jdbcType=INTEGER}
  </update>

  <!--触发投币-->
  <update id="giveCoin" parameterType="java.lang.Integer">
    UPDATE video SET video.get_icon=video.get_icon+1 where vid= #{vids,jdbcType=INTEGER}
  </update>


  <!--投稿-->
<insert id="Contribution" parameterType="com.gph.model.Video">
  insert into video(vname,vsrc,userid,v_image,type_id,vtime) VALUES(
  #{vname,jdbcType=VARCHAR},#{vsrc,jdbcType=VARCHAR},
  #{userid,jdbcType=INTEGER},
  #{vImage,jdbcType=VARCHAR},
  #{typeId,jdbcType=INTEGER},
  #{vtime,jdbcType=TIMESTAMP})
</insert>

<!--根据videoType select info-->
<select id="selectVideoByType" parameterType="java.lang.Integer" resultMap="BaseResultMap">
  select * from video where type_id = #{typeId.jdbcType=INTEGER}
</select>


  <!--修改视频标题和类型-->
  <update id="update_vname_type" parameterType="com.gph.model.Video">
    update video set
    vname = #{vname,jdbcType=VARCHAR},
    type_id = #{typeId,jdbcType=INTEGER}
    where vid = #{vid,jdbcType=INTEGER}
  </update>


  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from video
    where vid = #{vid,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.gph.model.Video" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into video (vid, vname, vsrc, 
      userid, praise, get_icon, 
      type_id, v_image)
    values (#{vid,jdbcType=INTEGER}, #{vname,jdbcType=VARCHAR}, #{vsrc,jdbcType=VARCHAR}, 
      #{userid,jdbcType=INTEGER}, #{praise,jdbcType=INTEGER}, #{getIcon,jdbcType=INTEGER}, 
      #{typeId,jdbcType=INTEGER}, #{vImage,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.gph.model.Video" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into video
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="vid != null" >
        vid,
      </if>
      <if test="vname != null" >
        vname,
      </if>
      <if test="vsrc != null" >
        vsrc,
      </if>
      <if test="userid != null" >
        userid,
      </if>
      <if test="praise != null" >
        praise,
      </if>
      <if test="getIcon != null" >
        get_icon,
      </if>
      <if test="typeId != null" >
        type_id,
      </if>
      <if test="vImage != null" >
        v_image,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="vid != null" >
        #{vid,jdbcType=INTEGER},
      </if>
      <if test="vname != null" >
        #{vname,jdbcType=VARCHAR},
      </if>
      <if test="vsrc != null" >
        #{vsrc,jdbcType=VARCHAR},
      </if>
      <if test="userid != null" >
        #{userid,jdbcType=INTEGER},
      </if>
      <if test="praise != null" >
        #{praise,jdbcType=INTEGER},
      </if>
      <if test="getIcon != null" >
        #{getIcon,jdbcType=INTEGER},
      </if>
      <if test="typeId != null" >
        #{typeId,jdbcType=INTEGER},
      </if>
      <if test="vImage != null" >
        #{vImage,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.gph.model.Video" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update video
    <set >
      <if test="vname != null" >
        vname = #{vname,jdbcType=VARCHAR},
      </if>
      <if test="vsrc != null" >
        vsrc = #{vsrc,jdbcType=VARCHAR},
      </if>
      <if test="userid != null" >
        userid = #{userid,jdbcType=INTEGER},
      </if>
      <if test="praise != null" >
        praise = #{praise,jdbcType=INTEGER},
      </if>
      <if test="getIcon != null" >
        get_icon = #{getIcon,jdbcType=INTEGER},
      </if>
      <if test="typeId != null" >
        type_id = #{typeId,jdbcType=INTEGER},
      </if>
      <if test="vImage != null" >
        v_image = #{vImage,jdbcType=VARCHAR},
      </if>
    </set>
    where vid = #{vid,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.gph.model.Video" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update video
    set vname = #{vname,jdbcType=VARCHAR},
      vsrc = #{vsrc,jdbcType=VARCHAR},
      userid = #{userid,jdbcType=INTEGER},
      praise = #{praise,jdbcType=INTEGER},
      get_icon = #{getIcon,jdbcType=INTEGER},
      type_id = #{typeId,jdbcType=INTEGER},
      v_image = #{vImage,jdbcType=VARCHAR}
    where vid = #{vid,jdbcType=INTEGER}
  </update>
</mapper>